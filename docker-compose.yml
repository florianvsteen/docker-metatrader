version: "3.9"

services:
  metatrader5:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: metatrader5
    hostname: metatrader5

    environment:
      - MT5_SERVER=Demo.ICMarkets.com:443
      - MT5_LOGIN=123456
      - MT5_PASSWORD=YourPasswordHere
      - VNC_PASSWORD=trader123
      - VNC_PORT=5901
      - NOVNC_PORT=6080

    ports:
      - "6080:6080"
      - "5901:5901"

    volumes:
      # Wine prefix â€” contains the MT5 installation
      - wine_prefix:/home/trader/.wine
      # First-run flag (persisted so reinstall is skipped on restart)
      - mt5_state:/home/trader
      # EAs / Scripts / Indicators
      - ./mql5/Experts:/home/trader/mt5-data/MQL5/Experts
      - ./mql5/Scripts:/home/trader/mt5-data/MQL5/Scripts
      - ./mql5/Indicators:/home/trader/mt5-data/MQL5/Indicators
      # Logs
      - ./logs:/home/trader/mt5-data/logs

    restart: unless-stopped

    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 2G
        reservations:
          cpus: "0.5"
          memory: 512M

    healthcheck:
      test: ["CMD", "pgrep", "-f", "terminal64.exe"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 180s

volumes:
  wine_prefix:
    name: mt5_wine_prefix
  mt5_state:
    name: mt5_state
